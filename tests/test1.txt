######################################################################
# 测试 1/1
问题: 如何查询2025.12.11发生还款且手机号验证通过的借款用户，截止到昨天的待还金额以及还款金额，还款率
######################################################################
开始调用智能体
回答: 要查询2025年12月11日发生还款且手机号验证通过的借款用户，截止到昨天的待还金额、还款金额以及还款率，我们需要从以下几个表中获取信息：

1. **用户表 (users)**：
   - `id`: 用户唯一ID
   - `mobile_phone`: 手机号
   - `mobile_phone_verified`: 手机号验证状态（1表示已验证）

2. **借款订单表 (sgo_orders)**：
   - `user_id`: 关联到用户表的用户ID
   - `payable_amount`: 应还金额
   - `repayment_amount`: 已还金额
   - `repay_at`: 还款完成时间

3. **还款记录表 (sgo_repayments)**：
   - `user_id`: 关联到用户表的用户ID
   - `repayment_amount`: 实际还款金额
   - `due_amount`: 应还金额

### SQL 查询示例

以下是一个可能的 SQL 查询示例：

```sql
SELECT 
    u.id AS user_id,
    u.mobile_phone,
    SUM(o.payable_amount) AS total_due_amount,
    SUM(r.repayment_amount) AS total_repayment_amount,
    CASE 
        WHEN SUM(o.payable_amount) > 0 THEN 
            SUM(r.repayment_amount) / SUM(o.payable_amount) * 100 
        ELSE 0 
    END AS repayment_rate
FROM 
    users u
JOIN 
    sgo_orders o ON u.id = o.user_id
JOIN 
    sgo_repayments r ON o.id = r.order_id
WHERE 
    u.mobile_phone_verified = 1
    AND r.repay_at = '2025-12-11'
GROUP BY 
    u.id, u.mobile_phone;
```

### 解释

- **选择字段**：
  - `u.id` 和 `u.mobile_phone`：获取用户ID和手机号。
  - `SUM(o.payable_amount)`：计算每个用户的总待还金额。
  - `SUM(r.repayment_amount)`：计算每个用户的总还款金额。
  - `CASE` 语句用于计算还款率，如果待还金额大于0，则计算还款率，否则返回0。

- **连接表**：
  - 使用 `JOIN` 将用户表、借款订单表和还款记录表连接在一起，以便获取所需的所有信息。

- **条件过滤**：
  - `u.mobile_phone_verified = 1`：确保只选择手机号已验证的用户。
  - `r.repay_at = '2025-12-11'`：确保只选择在指定日期还款的记录。

- **分组**：
  - 使用 `GROUP BY` 按用户ID和手机号分组，以便计算每个用户的总待还金额和总还款金额。

请根据实际的数据库结构和需求调整查询。